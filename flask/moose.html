<!DOCTYPE html>
<meta charset="utf-8">

<head>
    <title>Pete's d3.js test</title>
    <style>
    body 
    {
 
        background-color: #ccccee ;
    }
    h1
    {
        font-family: 'Candara';
        color: #4400aa;

    }
    p
    {
        font-family: 'Cambria';
    }
</style>
</head>

<body>




    <div>
        <h1> Pete's D3.js test</h1>
        <p>
            Our geodata webapp and data faker are working. want to do a quick html/javascript in here that will request data from localhost:5000/geoData, and plot it using d3.js (and/or leaflet).
        </p>
        <p>
            The example <a href='http://bl.ocks.org/d3noob/6bd13f974d6516f3e491'>here</a> is useful
        </p>
    </div>
    <div id='testContainer' style='background-color: #000000;'>

    </div>

    <script src="http://d3js.org/d3.v4.min.js"></script>

    <script>

        // data 
        var sampleJSON = [
          {
            "datetime_utc": "2017-12-02 19:25:43.385302", 
            "geo_latt": 43.663882691173065, 
            "geo_long": -79.35721220008752, 
            "id": 1
          }, 
          {
            "datetime_utc": "2017-12-02 19:26:04.390297", 
            "geo_latt": 43.664556979213735, 
            "geo_long": -79.40225059479273, 
            "id": 2
          }, 
          {
            "datetime_utc": "2017-12-02 19:26:25.395848", 
            "geo_latt": 43.66433493889307, 
            "geo_long": -79.39336584153828, 
            "id": 3
          }, 
          {
            "datetime_utc": "2017-12-02 19:26:46.516506", 
            "geo_latt": 43.65999706808017, 
            "geo_long": -79.39296230319867, 
            "id": 4
          }
        ];

        // define height and width
        var margin = {
            left:50,
            top:10,
            bottom:25,
            right:10
        }
        var totalWidth = 600;
        var totalHeight = 600;
        var width = totalWidth - margin.left - margin.right;
        var height = totalHeight - margin.top - margin.bottom;

        // define scale ranges (domains based off data)
        var x = d3.scaleLinear().range([0,width]);
        var y = d3.scaleLinear().range([height,0]);
        
        // var latlongbuffer = 0.001
        // set domain - would like to add a buffer here, say extent*1.05
        // x.domain([d3.min(sampleJSON,function(d){return d.geo_long}) -latlongbuffer, d3.max(sampleJSON, function(d) {return d.geo_long}) +latlongbuffer]);

        // y.domain([d3.min(sampleJSON,function(d){return d.geo_latt}) -latlongbuffer, d3.max(sampleJSON, function(d) {return d.geo_latt}) +latlongbuffer]);

        x.domain(d3.extent(sampleJSON,function(d){return d.geo_long}));
        y.domain(d3.extent(sampleJSON,function(d){return d.geo_latt}));

        

        // could also create a time - colour scale, and set marker fill colour based on age

        // create an svg container for stuff
        var svg = d3.select('#testContainer')
            .append("svg:svg")
                .attr("width",totalWidth)
                .attr("height",totalHeight)
                .attr('style','background-color: #ffffff;')
            .append('g')
                .attr('transform','translate('+margin.left +',' + margin.top + ')');

        // add some markers based on data
        svg.selectAll('circle').data(sampleJSON).enter().append('circle')
            .attr("cx",function(d){return x(d.geo_long)})
            .attr("cy",function(d){return y(d.geo_latt)})
            .attr("r",5)
            .attr('fill','red');

        var xAxis = d3.axisBottom().scale(x).ticks(5)
        var yAxis = d3.axisLeft().scale(y).ticks(5)

         // Add the X Axis
        svg.append("g")
            .attr("class", "x axis")
            .attr("transform", "translate(0," + height + ")")
            .call(xAxis);

        // Add the Y Axis
        svg.append("g")
            .attr("class", "y axis")
            .call(yAxis);

    </script>

</body>



